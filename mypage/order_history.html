<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8" />
    <meta name="csrf-token" content="{{ csrf_token() }}" />
    <title>Web発注システム</title>
    <link rel="icon" type="image/png" href="../images/sitelogo.png" />
    <link rel="stylesheet" href="../css/bootstrap.min.css" />
    <link rel="stylesheet" href="../css/style.css" />
    <link rel="stylesheet" href="../css/order_history.css" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet" />
    <script src="../js/jquery-3.7.1.min.js"></script>
</head>

<body>
    <!-- header -->
    <div class="container-logo">
        <nav class="nav-logo">
            <img src="../images/tennic-logo.png" alt="Logo" />
        </nav>

        <nav class="navbar-50">
            <span class="text-white">スポーツハウス アローザ </span>
        </nav>
    </div>

    <div class=" main-container">
        <!-- left menu -->
        <aside>
            <div class="container mt-2 position-relative ">
                <button class="btn btn-primary mb-4 d-flex justify-content-between align-items-center rounded-0"
                    onclick="location.href='./order_detail.html'">
                    <span class="mx-auto">直接入力</span>
                    <img src="../images/chevron-right.svg">
                </button>
                <hr>

                <div class="mb-4 text-center">
                    <label class="form-label">品番</label>
                    <input type="text" class="form-control rounded-0" />
                    <input type="text" class="form-control rounded-0" />
                    <input type="text" class="form-control rounded-0" />
                    <input type="text" class="form-control rounded-0" />
                    <input type="text" class="form-control rounded-0" />
                </div>

                <div class="mb-3 text-center">
                    <label class="form-label text-decoration-underline">ブランド選択</label>
                    <div class="d-inline-block position-relative mb-2">
                        <div class="form-control rounded-0 f2f2-bg tooltip-input" onmouseover="showTooltip(this)"
                            onmouseout="hideTooltip(this)">
                            ヨネックス
                        </div>
                    </div>
                </div>

                <div class="mb-3 text-center">
                    <label class="form-label text-decoration-underline">カテゴリ選択</label>
                    <div class="d-inline-block position-relative mb-2">
                        <div class="form-control rounded-0 f2f2-bg tooltip-input" onmouseover="showTooltip(this)"
                            onmouseout="hideTooltip(this)">
                            アクセサリ、シューズ
                        </div>
                    </div>
                </div>


                <button class="btn btn-primary mb-4 d-flex justify-content-between align-items-center rounded-0">
                    <span class="mx-auto">検索</span>
                    <img src="../images/chevron-right.svg">
                </button>
                <hr>
            </div>

            <label class="form-label mt-2">一括注文</label>
            <button class="btn btn-primary mb-2 d-flex justify-content-between align-items-center rounded-0">
                <span class="mx-auto">CSV選択</span>
                <img src="../images/chevron-right.svg">
            </button>

            <label class="form-label text-decoration-underline mb-5">一括注文とは？</label>

            <nav class="nav flex-column nav-list">
                <a class="nav-link text-white position-relative" href="./home.html">
                    <img src="../images/house-door-fill.svg" class="me-3"> ホーム
                </a>
                <a class="nav-link text-white position-relative" href="./order_history.html">
                    <img src="../images/file-earmark-text-fill.svg" class="me-3">注文履歴</a>
                <a class="nav-link text-white position-relative" href="./setting.html">
                    <img src="../images/gear_fill_menu.svg" class="me-3">設定</a>
                <a class="nav-link text-white position-relative nav-link-after" href="#">
                    <img src="../images/box-arrow-left.svg" class="me-2">ログアウト</a>
            </nav>
        </aside>

        <!-- main content -->
        <main class="flex-grow-1">
            <div class="order1">
                <div class="icon-hdr ">
                    <img src="../images/file-earmark-text-fill_order_history.svg" class="me-3">
                    <span>注文履歴</span>
                </div>
                <div class="orderhistory">
                    <div class="container-fluid c-for-o mt-4 pe-0">
                        <div class="d-flex">
                            <!-- Left Container-->
                            <div class="d-flex flex-column w-145">
                                <div class="fw-bold lh-26"><span>注文日</span></div>
                                <div class="fw-bold lh-26 m-10"><span>メーカー品番</span></div>
                                <div class="fw-bold lh-26 m-10"><span>Web注文番号</span></div>
                            </div>

                            <!-- Right Container  -->
                            <div class="d-flex flex-column w-100">
                                <!-- Date Selectors -->
                                <div class="d-flex align-items-center">
                                    <!-- Date Selectors -->
                                    <input type="date" id="startDate" class=" ps-1" lang="ja">
                                    <span class="ps-1 pe-1">~</span>
                                    <div class="d-flex align-items-center">
                                        <input type="date" id="endDate" class="ps-1 me-2" lang="ja">
                                        <div id="dateError" class="text-danger small d-none">
                                            日付・時刻の大小関係が正しくありません。
                                        </div>
                                    </div>
                                </div>
                                <!-- Text Inputs -->
                                <div class="d-flex align-items-center m-10">
                                    <input type="text" class="form-control mb-0">
                                </div>
                                <div class="d-flex align-items-center m-10">
                                    <input type="text" class="form-control mb-0">
                                </div>
                                <!-- search buttom -->
                                <div class="d-flex  mt-29">
                                    <div class="d-flex flex-column me-4">
                                        <button
                                            class="d-flex justify-content-center align-items-center border-0 sb-btn ">
                                            検索
                                        </button>
                                    </div>
                                    <div class="d-flex flex-column ">
                                        <button id="clearInputs"
                                            class="d-flex justify-content-center align-items-center border-0 sb-btn ">
                                            クリア
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                    <div class="container-fluid ms-0 pe-0 c-for-t">
                        <!-- Pagination at the end -->
                        <div class="d-flex justify-content-end">
                            <nav aria-label="Page navigation example">
                                <ul class="pagination pagination-sm mb-10">
                                    <li class="page-item">
                                        <a class="page-link border-0 ps-0" href="#" aria-label="Previous">
                                            <span class="clr-for-pagination fs-5">&larr;</span>
                                        </a>
                                    </li>
                                    <li class="page-item"><a class="page-link border-0 clr-for-pagination"
                                            href="#">1</a>
                                    </li>
                                    <li class="page-item"><a class="page-link border-0 clr-for-pagination2"
                                            href="#">2</a>
                                    </li>
                                    <li class="page-item"><a class="page-link border-0 clr-for-pagination2"
                                            href="#">3</a>
                                    </li>
                                    <li class="page-item"><a class="page-link border-0 clr-for-pagination2"
                                            href="#">4</a>
                                    </li>
                                    <li class="page-item"><a class="page-link border-0 clr-for-pagination2"
                                            href="#">5</a>
                                    </li>
                                    <li class="page-item"><a class="page-link border-0 clr-for-pagination2"
                                            href="#">6</a>
                                    </li>
                                    <li class="page-item"><a class="page-link border-0 clr-for-pagination2"
                                            href="#">7</a>
                                    </li>
                                    <li class="page-item"><a class="page-link border-0 clr-for-pagination3" href="#">. .
                                            .</a></li>
                                    <li class="page-item">
                                        <a class="page-link border-0 pe-0" href="#" aria-label="Next">
                                            <span class="clr-for-pagination fs-5">&rarr;</span>
                                        </a>
                                    </li>
                                </ul>
                            </nav>
                        </div>

                        <div class="container-fluid ms-0 ps-0 pe-0">
                            <table class="custom-table">
                                <thead>
                                    <tr>
                                        <th class="col-110 p-0" rowspan="2"></th>
                                        <th class="col-167 p-0">品番</th>
                                        <th class="col-574 p-0" colspan="3">商品名</th>
                                        <th class="col-90 p-0">注文数</th>
                                        <th class="col-101 p-0">単価</th>
                                        <th class="col-100 p-0">金額</th>
                                        <th class="col-70 p-0">引当数</th>
                                        <th class="col-71 p-0">引当結果</th>
                                        <th class="col-131 p-0">入荷予定日</th>
                                    </tr>
                                    <tr>
                                        <th class="col-167 p-0">注文日時</th>
                                        <th class="sub-col-250 p-0">ブランド</th>
                                        <th class="sub-col-180 p-0">カラー</th>
                                        <th class="sub-col-141 p-0">サイズ</th>
                                        <th class="row-416 p-0" colspan="5">摘要</th>
                                        <th class="row-131 p-0">Web注文番号</th>
                                    </tr>
                                </thead>
                            </table>
                        </div>
                        <div class="mt-3">
                            <table class="custom-table1">
                                <thead>
                                    <!-- renderTable() data appear here  -->
                                </thead>
                            </table>
                        </div>
                        <!-- Pagination -->
                        <div class="d-flex justify-content-end">
                            <nav aria-label="Page navigation example">
                                <ul class="pagination pagination-sm mb-0 mt-10">
                                    <li class="page-item">
                                        <a class="page-link border-0 ps-0" href="#" aria-label="Previous">
                                            <span class="clr-for-pagination fs-5">&larr;</span>
                                        </a>
                                    </li>
                                    <li class="page-item"><a class="page-link border-0 clr-for-pagination"
                                            href="#">1</a>
                                    </li>
                                    <li class="page-item"><a class="page-link border-0 clr-for-pagination2"
                                            href="#">2</a>
                                    </li>
                                    <li class="page-item"><a class="page-link border-0 clr-for-pagination2"
                                            href="#">3</a>
                                    </li>
                                    <li class="page-item"><a class="page-link border-0 clr-for-pagination2"
                                            href="#">4</a>
                                    </li>
                                    <li class="page-item"><a class="page-link border-0 clr-for-pagination2"
                                            href="#">5</a>
                                    </li>
                                    <li class="page-item"><a class="page-link border-0 clr-for-pagination2"
                                            href="#">6</a>
                                    </li>
                                    <li class="page-item"><a class="page-link border-0 clr-for-pagination2"
                                            href="#">7</a>
                                    </li>
                                    <li class="page-item"><a class="page-link border-0 clr-for-pagination3" href="#">. .
                                            .</a></li>
                                    <li class="page-item">
                                        <a class="page-link border-0 pe-0" href="#" aria-label="Next">
                                            <span class="clr-for-pagination fs-5">&rarr;</span>
                                        </a>
                                    </li>
                                </ul>
                            </nav>
                        </div>
                    </div>
                </div>
            </div>

            <!--詳 細 popup modal -->
            <div id="popupModal" class="popup-overlay">
                <div class="popup-content pc-w">
                    <span class="close-popup close-icon">&times;</span>
                    <div class="container mt-4 pc-c">
                        <div class="d-flex justify-content-start ">
                            <h5 class="fw-bold fs-6 mb-2">注文詳細</h5>
                        </div>
                        <hr class="w-100 m-0">
                        <div class="container wp-130 pe-4 ps-4 pb-4 pt-3">
                            <div class="d-flex">
                                <div class="d-flex flex-column pe-4">
                                    <div class="justify-content-start pt-2 cancel-date d-none"><span
                                            class="cancel-date-label">キャンセル日</span>
                                    </div>
                                    <div class="justify-content-start pt-2 cancel-person d-none">
                                        <span>キャンセル者</span>
                                    </div>
                                    <div class="justify-content-start pt-2"><span>注文者 </span></div>
                                    <div class="justify-content-start pt-2"><span>配送先 </span></div>
                                </div>
                                <div class="d-flex flex-column">
                                    <div class="justify-content-start pt-2 cancel-date d-none"><span
                                            class="cancel-date-value">: <span
                                                class="cancel-date-value-text"></span></span></div>
                                    <div class="justify-content-start pt-2 cancel-person d-none">
                                        <span>: 南島 (nanshima@n-info.jp)</span>
                                    </div>
                                    <div class="justify-content-start pt-2"><span>: 南島 (nanshima@n-info.jp)</span></div>
                                    <div class="justify-content-start pt-2"><span>: スポーツハウスアローザ</span></div>
                                </div>
                            </div>
                        </div>

                        <!-- Scrollable Text Box -->
                        <div class="text-start pb-2 ">
                            <span>注文備考</span>
                        </div>
                        <div class="scroll-box  justify-content-center" id="popup-scroll">
                            <span>入荷予定日が分かりましたら連絡していただきたいです。入荷予定日が分かりましたら連絡していただきたいです。入荷予定日が分かりましたら連絡していただきたいです。入荷予定日が分かりましたら連絡していただきたいです。入荷予定日が分かりましたら連絡していただきたいです。入荷予定日が分かりましたら連絡していただきたいです。入荷予定日が分かりましたら連絡していただきたいです。入荷予定日が分かりましたら連絡していただきたいです。入荷予定日が分かりましたら連絡していただきたいです。</span>
                        </div>
                    </div>

                    <div class="d-flex justify-content-center mt-4 pb-3 border-0">
                        <button class="popup-close-btn close-popup1">閉じる</button>
                    </div>
                </div>
            </div>
            <!-- キャンセル popup modal -->
            <div id="overlay"></div>
            <div id="confirmModal">
                <div class="modal-body justify-content-center">選択した商品の注文をキャンセルします。<br>よろしいですか？</div>
                <div class="modal-footer d-flex d-flex-row justify-content-between mt-4">
                    <button class="btn btn-danger d-flex align-items-center justify-content-center"
                        id="confirmYes">はい</button>
                    <button class="btn btn-secondary d-flex align-items-center justify-content-center"
                        id="closeModal">いいえ</button>
                </div>
            </div>

            <!-- Web-order No: Popup -->
            <div id="orderDetailsPopup" class="popup-overlay-custom">
                <div class="popup-content-custom">
                    <div class="pphd-custom">
                        <span class="close-popup-custom">&times;</span>
                        <div class="scrollable-table-container">
                            <span>Web注文番号: ${item.Web注文番号}</span>
                            <table class="custom-table2">
                                <thead>
                                    <tr>
                                        <th class="col-167 p-0" rowspan="2">品番</th>
                                        <th class="col-737 p-0" colspan="3">商品名</th>
                                        <th class="col-121 p-0">注文数</th>
                                        <th class="col-121 p-0">単価</th>
                                        <th class="col-120 p-0">金額</th>
                                    </tr>
                                    <tr>
                                        <th class="sub-col-297 p-0">ブランド</th>
                                        <th class="sub-col-240 p-0">カラー</th>
                                        <th class="sub-col-200 p-0">サイズ</th>
                                        <th class="row-360 p-0" colspan="3">摘要</th>
                                    </tr>
                                    <tr class="h-10"></tr>
                                </thead>
                                <tbody id="orderDetailsPopupData" class="scoll_tbody"></tbody>
                            </table>
                        </div>
                    </div>
                    <div class="d-flex justify-content-end pt-2 me-88">
                        <label class="me-3">合計金額: </label>
                        <div class="d-flex">
                            <div class="d-flex justify-content-end align-items-center border-0" id="total-amount">
                            </div>
                        </div>
                    </div>
                    <div class="d-flex justify-content-center align-content-end mt-2 border-0">
                        <button class="popup-close-btn close-close">閉じる</button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        //Tooltip func 
        function showTooltip(element) {
            let tooltip = document.querySelector('.tooltip-box');
            if (!tooltip) {
                tooltip = document.createElement('div');
                tooltip.classList.add('tooltip-box');
                document.body.appendChild(tooltip);
            }

            tooltip.textContent = element.textContent.trim();
            if (element.scrollWidth - element.clientWidth > 0) {
                const rect = element.getBoundingClientRect();
                tooltip.style.display = 'block';
                tooltip.style.top = `${rect.top + window.scrollY + element.offsetHeight + 15}px`;
                tooltip.style.left = `${rect.left + window.scrollX}px`;

                let tooltipRect = tooltip.getBoundingClientRect();
                const windowWidth = window.innerWidth;

                if (tooltipRect.right > windowWidth) {
                    let currentLeft = parseInt(tooltip.style.left) || 0;
                    let newLeft = currentLeft - (tooltipRect.right - windowWidth) - 50;
                    tooltip.style.left = `${newLeft}px`;
                    tooltipRect = tooltip.getBoundingClientRect();
                    let arrowLeft = rect.left - tooltipRect.left + element.offsetWidth / 4 - 15;
                    tooltip.style.setProperty('--tooltip-arrow-left', `${arrowLeft}px`);
                } else {
                    let arrowLeft = element.offsetWidth / 4 - 15;
                    tooltip.style.setProperty('--tooltip-arrow-left', `${arrowLeft}px`);
                }
            } else {
                tooltip.style.display = 'none';
            }
        }

        function hideTooltip() {
            const tooltip = document.querySelector('.tooltip-box');
            if (tooltip) {
                tooltip.style.display = 'none';
            }
        }
        // ------------------------------------------------------------------------------------------------------
        // Popup 

        $(document).ready(function () {
            // Highlight active navigation link
            let currentPage = window.location.pathname.split("/").pop();
            $(".nav-list .nav-link").removeClass("active-nav");
            $('.nav-list .nav-link[href="./' + currentPage + '"]').addClass("active-nav");

            // ------------------------------------------------------------------------------------------------------
            //popup for order detatil
            $(document).on("click", ".popup-trigger", function (e) {
                e.preventDefault();

                const secondRow = $(this).closest("tr");
                const firstRow = secondRow.prev(); // corresponding first row
                const cancelText1 = firstRow.find(".cancel-text1");
                const isCancelled = cancelText1.is(":visible");
                const cancelDate = firstRow.attr("data-cancel-date") || secondRow.attr("data-cancel-date");

                // Handle cancel-date section
                if (isCancelled && cancelDate) {
                    $("#popupModal .cancel-date").removeClass("d-none");
                    $("#popupModal .cancel-date-value-text").text(cancelDate);
                } else {
                    $("#popupModal .cancel-date").addClass("d-none");
                    $("#popupModal .cancel-date-value-text").text("");
                }

                // Handle cancel-person section
                if (isCancelled && cancelDate) {
                    $("#popupModal .cancel-person").removeClass("d-none");
                } else {
                    $("#popupModal .cancel-person").addClass("d-none");
                }

                $(".popup-overlay, #popupModal").fadeIn();
            });

            //close func
            $(document).on("click", ".close-popup, .popup-overlay, #closeModal, #overlay, .popup-close-btn, .close-popup-custom", function () {
                // Reset scroll and fade out elements
                $(".scroll-box, .scoll_tbody").scrollTop(0);
                $(".popup-overlay, #popupModal, #overlay, #confirmModal").fadeOut(300);
            });

            $(document).on("click", ".popup-content", function (e) {
                e.stopPropagation();
            });

            //キャンセル popup
            $(document).on("click", ".cancel-text", function () {
                var firstRow = $(this).closest("tr");
                var secondRow = firstRow.next(); // the second part of the two-row entry

                $("#confirmYes").data("rows", [firstRow, secondRow]); // save both rows
                $("#overlay, #confirmModal").fadeIn();
            });

            $(document).on("click", "#confirmYes", function () {
                const [firstRow, secondRow] = $(this).data("rows");

                if (firstRow && secondRow) {
                    firstRow.find(".cancel-text").hide();
                    firstRow.find(".cancel-text1").removeClass("d-none");

                    const cancelDate = new Date().toLocaleString();

                    // Set cancel-date attribute to both rows
                    secondRow.attr("data-cancel-date", cancelDate);
                }

                $("#overlay, #confirmModal").fadeOut();
            });

            $(document).on("click", "#closeModal, #overlay", function () {
                $("#overlay, #confirmModal").fadeOut();
            });

            //display Web注文番号: popup
            $(document).on("click", " .popup-trigger1", function () {
                var webOrderNumber = $(this).data("web-order"); // Get Web注文番号

                $("#orderDetailsPopup span:contains('Web注文番号')").html("Web注文番号: " + webOrderNumber);

                $("#orderDetailsPopup").fadeIn();
            });

            $(document).on("click", ".close-popup-custom, .popup-close-btn", function () {
                $("#orderDetailsPopup").fadeOut();
            });

            // function for clear btn
            $(document).on("click", "#clearInputs", function () {
                // Clear date inputs
                $("#startDate").val("");
                $("#endDate").val("");
                // Clear text inputs
                $(".form-control").val("");
                // Hide the error message
                $("#dateError").addClass("d-none");
            });


        });

        //dummyData for looping the table data
        document.addEventListener("DOMContentLoaded", function () {
            const dummyData = [
                {
                    "品番": "10601j",
                    "商品名": "ゲームシャツ/ジュニア(106013)ゲームシャツ/ジュニア(106013)ゲームシャツ/ジュニア(106013)ゲームシャツ/ジュニア(106013)ゲームシャツ/ジュニア(106013)",
                    "注文数": 0,
                    "単価": " 920000",
                    "金額": " 1840000000",
                    "引当数": 0,
                    "入荷予定日": "2024/09/04",
                    "注文日時": "2024/09/21 16:23",
                    "ブランド": "アシックス",
                    "カラー": "ホワイト",
                    "サイズ": "J120",
                    "丸丸": "こんにちは、お会いできて嬉しいです。こんにちは、お会いできて嬉しいです。",
                    "Web注文番号": "W1234567855",
                    "キャンセル": "2025/02/18 11:28:03"
                },
                {
                    "品番": "10602j",
                    "商品名": "サッカーシャツ(106014)",
                    "注文数": 3,
                    "単価": "850000",
                    "金額": "2550000000",
                    "引当数": 3,
                    "入荷予定日": "2024/09/05",
                    "注文日時": "2024/09/21 14:10",
                    "ブランド": "ナイキ",
                    "カラー": "ブルー",
                    "サイズ": "J130",
                    "丸丸": "こんにちは、お会いできて嬉しいです。",
                    "Web注文番号": "W1234567855",
                    "キャンセル": "2025/02/18 01:08:03"
                },
                {
                    "品番": "10603j",
                    "商品名": "バスケシャツ(106015)",
                    "注文数": 1,
                    "単価": "780000",
                    "金額": "7700000000",
                    "引当数": 0,
                    "入荷予定日": "2024/09/06",
                    "注文日時": "2024/09/23 12:05",
                    "ブランド": "プーマ",
                    "カラー": "ブラック",
                    "サイズ": "J140",
                    "丸丸": "こんにちは、お会いできて嬉しいです。",
                    "Web注文番号": "W1234567855",
                    "キャンセル": "2025/02/18 01:28:03"
                },
                {
                    "品番": "10604j",
                    "商品名": "ランニングシャツ(106016)",
                    "注文数": 5,
                    "単価": "720000",
                    "金額": "3600000000",
                    "引当数": 5,
                    "入荷予定日": "2024/09/07",
                    "注文日時": "2024/09/24 18:30",
                    "ブランド": "ミズノ ミズノミズノミズノミズノミズノミズノミズノミズノ",
                    "カラー": "レッドレッドレッドレッドレッドレッドレッドレッドレッドレッド",
                    "サイズ": "J150 J150 J150 J150 J150 J150 J150 J150 J150 ",
                    "丸丸": "こんにちは、お会いできて嬉しいです。",
                    "Web注文番号": "W1234567855",
                    "キャンセル": "2025/02/18 14:58:03"
                },
                {
                    "品番": "10604j",
                    "商品名": "ランニングシャツ(106016)",
                    "注文数": 5,
                    "単価": "720000",
                    "金額": "3600000000",
                    "引当数": 7,
                    "入荷予定日": "2024/09/07",
                    "注文日時": "2024/09/24 18:30",
                    "ブランド": "ミズノ ミズノミズノミズノミズノミズノミズノミズノミズノ",
                    "カラー": "レッドレッドレッドレッドレッドレッドレッドレッドレッドレッド",
                    "サイズ": "J150 J150 J150 J150 J150 J150 J150 J150 J150 ",
                    "丸丸": "こんにちは、お会いできて嬉しいです。こんにちは、お会いできて嬉しいです。こんにちは、お会いできて嬉しいです。",
                    "Web注文番号": "W1234567855",
                    "キャンセル": "2025/02/18 15:28:05"
                },
                {
                    "品番": "10604j",
                    "商品名": "ランニングシャツ(106016)",
                    "注文数": 5,
                    "単価": "720000",
                    "金額": "3600000000",
                    "引当数": 10,
                    "入荷予定日": "2024/09/07",
                    "注文日時": "2024/09/24 18:30",
                    "ブランド": "ミズノ ミズノミズノミズノミズノミズノミズノミズノミズノ",
                    "カラー": "レッドレッドレッドレッドレッドレッドレッドレッドレッドレッド",
                    "サイズ": "J150 J150 J150 J150 J150 J150 J150 J150 J150 ",
                    "丸丸": "こんにちは、お会いできて嬉しいです。こんにちは、お会いできて嬉しいです。こんにちは、お会いできて嬉しいです。",
                    "Web注文番号": "W1234567855",
                    "キャンセル": "2025/02/18 15:28:05"
                },
                {
                    "品番": "10605j",
                    "商品名": "テニスシャツ106017)",
                    "注文数": 2,
                    "単価": "960000",
                    "金額": "1920000000",
                    "引当数": 5,
                    "入荷予定日": "2024/09/08",
                    "注文日時": "2024/09/25 10:45",
                    "ブランド": "ヨネックス",
                    "カラー": "グリーン",
                    "サイズ": "J160",
                    "丸丸": "こんにちは、お会いできて嬉しいです。",
                    "Web注文番号": "W1234567877",
                    "キャンセル": "2014/02/18 11:28:03"
                },
                {
                    "品番": "10606j",
                    "商品名": "トレーニングシャツ(106018)",
                    "注文数": 4,
                    "単価": "890000",
                    "金額": "3560000000",
                    "引当数": 8,
                    "入荷予定日": "2024/09/09",
                    "注文日時": "2024/09/26 15:15",
                    "ブランド": "アディダス",
                    "カラー": "イエロー",
                    "サイズ": "J170",
                    "丸丸": "こんにちは、お会いできて嬉しいです。",
                    "Web注文番号": "W1234567901",
                    "キャンセル": "2005/02/18 11:28:03"
                }
            ];

            // Function to render the table with filtered data
            document.querySelector(".sb-btn").addEventListener("click", function () {
                const startDateInput = document.getElementById("startDate").value;
                const endDateInput = document.getElementById("endDate").value;
                const productNumber = document.querySelectorAll(".form-control")[0].value.trim();
                const webOrderNumber = document.querySelectorAll(".form-control")[1].value.trim();

                const startDate = startDateInput ? new Date(startDateInput) : null;
                const endDate = endDateInput ? new Date(endDateInput) : null;

                const errorEl = document.getElementById("dateError");

                // Check date range validity
                if (startDate && endDate && startDate > endDate) {
                    errorEl.classList.remove("d-none");
                    return; // Stop the search if date is invalid
                } else {
                    errorEl.classList.add("d-none");
                }
                // filter the data
                const filteredData = dummyData.filter(item => {
                    const orderDate = new Date(item.注文日時.split(" ")[0].replace(/\//g, "-"));

                    const isWithinDateRange = (!startDate || orderDate >= startDate) && (!endDate || orderDate <= endDate);
                    const matchesProductNumber = !productNumber || item.品番.includes(productNumber);
                    const matchesWebOrderNumber = !webOrderNumber || item.Web注文番号.includes(webOrderNumber);

                    return isWithinDateRange && matchesProductNumber && matchesWebOrderNumber;
                });

                renderTable(filteredData);
            });


            //formatting the money with comma 
            function formatYen(value) {
                let number = value.replace(/&#165;|,/g, "");
                if (isNaN(number)) return value;
                return `&#165;${parseInt(number, 10).toLocaleString()}`;
            }

            // This is the popup for web order no:
            function attachPopupEvents() {
                $(document).on("click", ".popup-trigger1", function (event) {
                    event.preventDefault();
                    const webOrderNumber = $(this).data("web-order");
                    // Get Web注文番号 to show inside popup
                    $("#orderDetailsPopup span:contains('Web注文番号')").html("Web注文番号: " + webOrderNumber);

                    const filteredOrders = dummyData.filter(order => order.Web注文番号 === webOrderNumber);
                    if (filteredOrders.length > 0) {
                        let popupContent = "";
                        let totalAmount = 0;

                        filteredOrders.forEach(orderData => {
                            // Skip rendering and skip summing if 引当数 is 0 or less than 注文数
                            if (parseInt(orderData.引当数) === 0 || parseInt(orderData.引当数) < parseInt(orderData.注文数)) return;

                            const [date, time] = orderData.注文日時.split(" ");
                            // Calculate the amount 
                            let amount = parseInt(orderData.金額.replace(/,/g, "").trim(), 10) || 0;
                            totalAmount += amount;
                            //show popup
                            popupContent += `
                            <tr>
                                <td class="col-151 clr-table text-start pe-0 pt-0 pb-0 ps-1">${orderData.品番}</td>
                                <td class="col-737 clr-table pe-0 pt-0 pb-0 ps-1 text-start tooltip-input" colspan="3" onmouseover="showTooltip(this)" onmouseout="hideTooltip(this)">
                                    <span>${orderData.商品名}</span>
                                </td>
                                <td class="col-121 ps-0 pt-0 pb-0 pe7 clr-table text-end ">${orderData.注文数}</td>
                                <td class="col-121 ps-0 pt-0 pb-0 pe7 clr-table text-end ">${formatYen(orderData.単価)}</td>
                                <td class="col-120 ps-0 pt-0 pb-0 pe7 clr-table text-end ">${formatYen(orderData.金額)}</td>
                            </tr>
                            <tr>
                                <td class="col-167 clr-table text-start pe-0 pt-0 pb-0 ps-1">${date} ${time}</td>
                                <td class="sub-col-297 clr-table pe-0 pt-0 pb-0 ps-1 text-start tooltip-input" onmouseover="showTooltip(this)" onmouseout="hideTooltip(this)">
                                    <span>${orderData.ブランド}</span>
                                </td>
                                <td class="sub-col-240 clr-table pe-0 pt-0 pb-0 ps-1 text-start tooltip-input" onmouseover="showTooltip(this)" onmouseout="hideTooltip(this)">
                                    <span>${orderData.カラー}</span>
                                </td>
                                <td class="sub-col-200 clr-table pe-0 pt-0 pb-0 ps-1 text-start tooltip-input" onmouseover="showTooltip(this)" onmouseout="hideTooltip(this)">
                                    <span>${orderData.サイズ}</span>
                                </td>
                                <td class="row-360 clr-table text-start tooltip-input p-0" colspan="3" onmouseover="showTooltip(this)" onmouseout="hideTooltip(this)">
                                    <span>${orderData.丸丸}</span>
                                </td>
                            </tr>
                            <tr class="h-10"><hr></tr>
                        `;
                        });

                        $("#orderDetailsPopupData").html(popupContent);
                        $("#total-amount").html(`&#165;${totalAmount.toLocaleString()}`);
                        $("#orderDetailsPopup").fadeIn(300);
                    }
                });

                // Close popup for web order no: 
                $(document).on("click", ".close-popup-custom, .close-close", function () {
                    $("#orderDetailsPopup").fadeOut(300);
                });
            }

            // show table in page by looping
            function renderTable(data) {
                const table = document.querySelector(".custom-table1");
                table.innerHTML = "";

                data.forEach((item, index) => {
                    let statusColumn = "";
                    if (item.注文数 < item.引当数) {
                        statusColumn = '<span class="clr-table1 text-white ">一部引当OK</span>';
                    } else if (item.引当数 == 0 || item.引当数 < item.注文数) {
                        statusColumn = '<span class="clr-table4 text-white ">引当NG</span>';
                    } else if (item.注文数 == item.引当数) {
                        statusColumn = '<span class="clr-table2 text-white ">引当OK</span>';
                    }

                    const [date, time] = item.注文日時.split(" ");
                    const row = `
                    
                <tr>
                    <td class="col-110 p-0" rowspan="2">
                        <div class="d-flex justify-content-center align-items-center">
                            <button class="cancel-text border-0 text-white">キャンセル</button>
                            <span class="cancel-text1 d-none">キャンセル 済み</span>
                        </div>
                    </td>
                    <td class="col-167 pe-0 pt-0 pb-0 clr-table ps-1">${item.品番}</td>
                    <td class="col-574 pe-0 pt-0 pb-0 clr-table ps-1 tooltip-input" colspan="3" onmouseover="showTooltip(this)" onmouseout="hideTooltip(this)">
                        <span>${item.商品名}</span>
                    </td> 
                    <td class="col-90 ps-0 pt-0 pb-0 pe7 clr-table text-end ">${item.注文数}</td>
                    <td class="col-101 ps-0 pt-0 pb-0 pe7 clr-table text-end ">${formatYen(item.単価)}</td>
                    <td class="col-100 ps-0 pt-0 pb-0 pe7 clr-table text-end ">${formatYen(item.金額)}</td>
                    <td class="col-70 ps-0 pt-0 pb-0 pe7 clr-table text-end ">${item.引当数}</td>
                    <td class="col-71 p-0 clr-table">
                        <div class="d-flex justify-content-center align-items-center">
                        ${statusColumn}
                        </div>
                    </td>
                    <td class="col-131 pe-0 pt-0 pb-0 clr-table ps-2">${item.入荷予定日}</td>
                </tr>
                <tr> 
                    <td class="col-167 pe-0 pt-0 pb-0 clr-table ps-1">${date} ${time}</td>
                    <td class="sub-col-250 clr-table pe-0 pt-0 pb-0 ps-1 tooltip-input" onmouseover="showTooltip(this)" onmouseout="hideTooltip(this)">
                        <span>${item.ブランド}</span>
                    </td>
                    <td class="sub-col-180 clr-table pe-0 pt-0 pb-0 ps-1 tooltip-input"  onmouseover="showTooltip(this)" onmouseout="hideTooltip(this)">
                        <span>${item.カラー}</span>
                    </td>
                    <td class="sub-col-141 clr-table pe-0 pt-0 pb-0 ps-1 tooltip-input" onmouseover="showTooltip(this)" onmouseout="hideTooltip(this)">
                        <span>${item.サイズ}</span>
                    </td>
                    <td class="row-416 p-0 clr-table tooltip-input" colspan="5"  onmouseover="showTooltip(this)" onmouseout="hideTooltip(this)">
                        <span>${item.丸丸}</span>
                    </td>
                    <td class="row-131 pe-0 pt-0 pb-0 ps-1">
                        <div class="d-flex justify-content-between align-items-center">
                            <a href="#" class="text-black ps-1 popup-trigger1" data-web-order="${item.Web注文番号}">${item.Web注文番号}</a>
                            <button class="clr-table3 me-1 border-1 popup-trigger">詳 細</button>
                        </div>
                    </td>
                </tr>
                <tr class="h-10"></tr>
                `;
                    table.insertAdjacentHTML("beforeend", row);
                });
                attachPopupEvents();
            }
            renderTable(dummyData);
        });
    </script>
</body>

</html>